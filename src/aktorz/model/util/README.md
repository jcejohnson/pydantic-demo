All of this will be lifted out into a reusable library someday.
